<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pkgs.mapper.AnswerMapper">

    <resultMap id="resultMap" type="com.pkgs.entity.AnswerEntity">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="topic_id" property="topicId"/>
        <result column="question" property="question"/>
        <result column="question_id" property="questionId"/>
        <result column="answer_id" property="answerId"/>
        <result column="author" property="author"/>
        <result column="link" property="link"/>
        <result column="upvote_num" property="upvoteNum"/>
        <result column="comment_num" property="commentNum"/>
        <result column="summary" property="summary"/>
        <result column="create_at" property="createAt"/>
        <result column="update_at" property="updateAt"/>
        <result column="steal_at" property="stealAt"/>
    </resultMap>

    <sql id="fields">
        id,
        topic_id,
        question,
        question_id,
        answer_id,
        author,
        link,
        upvote_num,
        comment_num,
        summary,
        create_at,
        update_at,
        steal_at
    </sql>

    <sql id="search">
        <where>
            <if test="obj.id != null and obj.id != ''">
                AND `id` LIKE concat('%',#{obj.id},'%')
            </if>
            <if test="obj.topicId != null and obj.topicId != ''">
                AND `topic_id` LIKE concat('%',#{obj.topicId},'%')
            </if>
            <if test="obj.question != null and obj.question != ''">
                AND `question` LIKE concat('%',#{obj.question},'%')
            </if>
            <if test="obj.questionId != null and obj.questionId != ''">
                AND `question_id` LIKE concat('%',#{obj.questionId},'%')
            </if>
            <if test="obj.answerId != null and obj.answerId != ''">
                AND `answer_id` LIKE concat('%',#{obj.answerId},'%')
            </if>
            <if test="obj.author != null and obj.author != ''">
                AND `author` LIKE concat('%',#{obj.author},'%')
            </if>
            <if test="obj.link != null and obj.link != ''">
                AND `link` LIKE concat('%',#{obj.link},'%')
            </if>
            <if test="obj.upvoteNum != null and obj.upvoteNum != ''">
                AND `upvote_num` LIKE concat('%',#{obj.upvoteNum},'%')
            </if>
            <if test="obj.commentNum != null and obj.commentNum != ''">
                AND `comment_num` LIKE concat('%',#{obj.commentNum},'%')
            </if>
            <if test="obj.summary != null and obj.summary != ''">
                AND `summary` LIKE concat('%',#{obj.summary},'%')
            </if>
            <if test="obj.createAt != null and obj.createAt != ''">
                AND `create_at` LIKE concat('%',#{obj.createAt},'%')
            </if>
            <if test="obj.updateAt != null and obj.updateAt != ''">
                AND `update_at` LIKE concat('%',#{obj.updateAt},'%')
            </if>
            <if test="obj.stealAt != null and obj.stealAt != ''">
                AND `steal_at` LIKE concat('%',#{obj.stealAt},'%')
            </if>
        </where>
    </sql>


    <select id="selectByMap" resultMap="resultMap" parameterType="java.util.Map">
        SELECT
        <include refid="fields"/>
        FROM
        top_answer_t
        <include refid="search"/>
        ORDER BY upvote_num DESC
    </select>

    <select id="selectCount" parameterType="com.pkgs.entity.AnswerEntity">
        SELECT
        COUNT(*)
        FROM
        top_answer_t
        <include refid="search"/>
    </select>
</mapper>